<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head th:include="fragmentos/head :: head" th:remove="tag"></head>
<title>Lista de Aspirantes</title>
<body>
<div>
    <div class="site-wrapper" >
        <header class="header header-menu-fullw">

            <div th:include="fragmentos/top_bar :: top_bar(${user})" th:remove="tag"></div>

            <div th:include="fragmentos/menu :: menu(${user},${usr})" th:remove="tag"></div>

        </header>


        <div class="main" role="main" id="app">

            <div th:include="fragmentos/heading :: heading('Lista de Aspirantes')"></div>
            <section class="page-content">
                <div class="container">

                    <form class="job_filters" th:object="${filter}" th:o method="get"
                          @submit.prevent="onSubmit">

                        <div class="search_jobs center_block">

                            <div class="search_location">
                                <label for="location">I</label>
                                <span class="select-style">
										<select class="form-control" name="location" id="location"
                                                v-model="language_id">
                                            <option value="" selected>Idioma</option>
											<option value="EN">Inglés</option>
											<option value="IT">Italiano</option>
                                            <option value="DE">Alemán</option>
											<option value="JA">Japonés</option>
										</select>
                                </span>
                            </div>

                            <div class="search_location">
                                <span class="select-style">
                                        <select class="form-control" id="skills_id"
                                                v-model="skills_id">

                                            <option value="">Habilidades</option>

                                            <option v-for="skill in skills"
                                                    :value="skill.id"
                                                    v-text="skill.titulo">

                                        </select>
                                </span>
                            </div>

                            <div class="search_location">
                                <span class="select-style">
										<select class="form-control" name="location" id="education"
                                                v-model="education">
                                            <option value="" selected>Nivel Educacional</option>
											<option value="BACHILLER">BACHILLER</option>
											<option value="UNIVERSITARIO_1">1er año de universidad</option>
                                            <option value="UNIVERSITARIO_2">2er año de universidad</option>
											<option value="UNIVERSITARIO_3">3er año de universidad</option>
											<option value="UNIVERSITARIO_4">4er año de universidad</option>
											<option value="UNIVERSITARIO_5">5er año de universidad</option>
											<option value="EGRESADO">EGRESADO</option>
											<option value="GRADUADO">GRADUADO</option>
										</select>
                                </span>
                            </div>



                            <div class="search_submit">
                                <label>Submit</label>
                                <button class="btn btn-block btn-primary"><i class="fa fa-search"></i></button>
                            </div>
                            <div class="search_submit">
                                <label>Submit</label>
                                <button class="btn btn-block btn-primary" @click="limpiar"><i class="fa fa-eraser"></i>Limpiar</button>
                            </div>
                        </div>
                    </form>

                    <div class="row" v-for="aspirante in candidates">
                        <div class="call-to-action" >
                            <div class="cta-txt">
                                <div class="row">
                                    <div class="col-md-8">
                                        <h3>{{aspirante.name}} {{aspirante.lastName}} </h3>
                                        <p>Correo: {{aspirante.email}}</p>
                                        <p>Teléfono: {{aspirante.phonenumber}}</p>
                                        <p>Fecha de Nacimiento: {{aspirante.birthday}}</p>
                                        <p>{{aspirante.stateOfEducation}}</p>

                                    </div>
                                    <div class="cold-md-2">
                                        <div v-if="aspirante.academicExperiences.length !=0">
                                            <h5>Educación:</h5>
                                            <ul>
                                                <li></li>
                                            </ul>
                                        </div>
                                        <div v-if="aspirante.postulantLanguages.length !=0">
                                            <h5>Idiomas:</h5>
                                            <ul v-for="idioma in aspirante.postulantLanguages">
                                                <li>{{idioma.language.nombre}} -> Nivel: {{idioma.languageLevel}}</li>
                                            </ul>
                                        </div>
                                        <div v-if="aspirante.skills.length !=0">
                                            <h5>Habilidades:</h5>
                                            <ul v-for="habilidad in aspirante.skills">
                                                <li>{{habilidad.skill.titulo}}</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="cta-btn-candidato">
                                <a @click="redirectPerfil(aspirante.postulant.username)" class="btn btn-primary">Perfil</a>
                                <br><br>
                            </div>

                        </div>

                        <div class="spacer"></div>
                    </div>

                </div>
                <div class="spacer-lg"></div>

                <div v-if="candidates.length == 0" class="call-to-action centered">
                    <div class="spacer"></div>
                    <div class="cta-txt">
                        <h2>Ninguna persona ha aplicado a este puesto</h2>
                        <p>¡Aplica al puesto de trabajo que más te conviene!</p>
                    </div>

                    <div class="spacer"></div>
                </div>

            </section>
        </div>

    </div>


    <div th:include="fragmentos/footer :: footer"></div>
</div>

<div th:include="fragmentos/scripts :: scripts" ></div>

<script th:inline="javascript">let candidates = [[${candidates}]];</script>
<script th:inline="javascript">let job_id = [[${job_id}]];</script>
<script th:inline="javascript">let skills = [[${skills}]];</script>
<script>
    new Vue({
        el: "#app",
        data: {
            language_id: "",
            skills_id: "",
            education: "",
            candidates: candidates,
            skills: skills,
        },
        methods: {
            redirectPerfil(user){
                window.location.href = "/postulante/"+user+"/perfil";
            },
            onSubmit(){
                if(this.skills_id !== "" && this.language_id !== "" && this.education === ""){ // habilidades e idiomas (ya)
                    axios.get("/job/candidatos/puesto/"+job_id+"/habilidad/"+this.skills_id+"/idioma/"+this.language_id)
                        .then(response => {
                            console.log(response);
                            this.candidates = response.data;
                            showMessageTimer("Resultados",response.headers.message,"success",2500);
                        })
                        .catch(error => {
                            console.log(error.response);
                            if(error.response.status >= 400 && error.response.status <= 499){
                                showMessageTimer("Error",error.response.headers.message,"error",2500);
                            }
                        })
                }
                if(this.skills_id !== "" && this.language_id === "" && this.education !== ""){ // habilidades y educacion (ya)
                    axios.get("/job/candidatos/puesto/"+job_id+"/habilidad/"+this.skills_id+"/educacion/"+this.education)
                        .then(response => {
                            console.log(response);
                            this.candidates = response.data;
                            showMessageTimer("Resultados",response.headers.message,"success",2500);

                        })
                        .catch(error => {
                            console.log(error.response);
                            if(error.response.status >= 400 && error.response.status <= 499){
                                showMessageTimer("Error",error.response.headers.message,"error",2500);
                            }
                        })
                }
                if(this.skills_id === "" && this.language_id !== "" && this.education !== ""){ // idioma y educacion (ya)
                    axios.get("/job/candidatos/puesto/"+job_id+"/idioma/"+this.language_id+"/educacion/"+this.education)
                        .then(response => {
                            console.log(response);
                            this.candidates = response.data;
                            showMessageTimer("Resultados",response.headers.message,"success",2500);

                        })
                        .catch(error => {
                            console.log(error.response);
                            if(error.response.status >= 400 && error.response.status <= 499){
                                showMessageTimer("Error",error.response.headers.message,"error",2500);
                            }
                        })
                }
                if(this.skills_id !== "" && this.language_id !== "" && this.education !== ""){ // idioma y educacion y habilidad
                    axios.get("/job/candidatos/puesto/"+job_id+"/idioma/"+this.language_id+"/educacion/"+this.education+"/habilidad/"+this.skills_id)
                        .then(response => {
                            console.log(response);
                            this.candidates = response.data;
                            showMessageTimer("Resultados",response.headers.message,"success",2500);

                        })
                        .catch(error => {
                            console.log(error.response);
                            if(error.response.status >= 400 && error.response.status <= 499){
                                showMessageTimer("Error",error.response.headers.message,"error",2500);
                            }
                        })
                }
                if(this.skills_id !== "" && this.language_id === "" && this.education === ""){ // solo habilidad (ya)
                    axios.get("/job/candidatos/puesto/"+job_id+"/habilidad/"+this.skills_id)
                        .then(response => {
                            console.log(response);
                            this.candidates = response.data;
                            showMessageTimer("Resultados",response.headers.message,"success",2500);

                        })
                        .catch(error => {
                            console.log(error.response);
                            if(error.response.status >= 400 && error.response.status <= 499){
                                showMessageTimer("Error",error.response.headers.message,"error",2500);
                            }
                        })
                }
                if(this.language_id !== "" && this.skills_id === "" && this.education === ""){ // solo lenguaje (ya)
                    axios.get("/job/candidatos/puesto/"+job_id+"/lenguaje/"+this.language_id)
                        .then(response => {
                            console.log(response);
                            this.candidates = response.data;
                            showMessageTimer("Resultados",response.headers.message,"success",2500);

                        })
                        .catch(error => {
                            console.log(error.response);
                            if(error.response.status >= 400 && error.response.status <= 499){
                                showMessageTimer("Error",error.response.headers.message,"error",2500);
                            }
                        })
                }

                if(this.education !== "" && this.skills_id === "" && this.language_id === ""){ // solo educacion (ya)
                    axios.get("/job/candidatos/puesto/"+job_id+"/educacion/"+this.education)
                        .then(response => {
                            console.log(response);
                            this.candidates = response.data;
                            showMessageTimer("Resultados",response.headers.message,"success",2500);

                        })
                        .catch(error => {
                            console.log(error.response);
                            if(error.response.status >= 400 && error.response.status <= 499){
                                showMessageTimer("Error",error.response.headers.message,"error",2500);
                            }
                        })
                }
            },
            limpiar: function (event) {
                if(event){
                    window.location.href = "/puesto/"+job_id+"/aspirantes";
                }
            }
        },
    })
</script>
</body>
</html>

